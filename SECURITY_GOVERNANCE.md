# AI Project OS MCP 安全与治理白皮书

## 一、概述

AI Project OS MCP 是一个工程级 AI 行为治理引擎，通过强状态机 + 可审计工具链，将 AI 自动编程约束在真实、可验收、可追责的软件工程流程中。

## 二、安全边界与非目标

### 2.1 治理范围

- ✅ 工程流程约束：确保 AI 遵循 5S 工作流
- ✅ 代码生成控制：确保只在 S5 阶段生成代码
- ✅ 审计日志管理：确保所有操作都有完整审计记录
- ✅ 权限与访问控制：防止 Agent 越权操作
- ✅ 依赖治理：防止恶意依赖注入

### 2.2 非目标（Non-goals）

- ❌ **不保证 AI 生成的业务逻辑正确性**：系统专注于治理、审计和约束，而非正确性验证
- ❌ **不替代人类审查**：系统是治理工具，不是代码审查工具
- ❌ **不检测业务逻辑错误**：系统不理解业务逻辑，只关注流程合规性
- ❌ **不提供代码质量保证**：代码质量由 AI 和人类审查共同负责

## 三、安全架构

### 2.1 核心安全设计原则

1. **状态优先于提示**：项目真相存储在 `state.json` 中，而非对话记忆
2. **冻结优先于生成**：所有决策必须在执行前冻结
3. **审计优先于输出**：无审计的代码不被视为完成
4. **拒绝违规执行比勉强完成任务更正确**

### 2.2 安全控制层级

| 控制层级 | 实现方式 | 保护对象 |
|---------|---------|---------|
| 流程控制 | 5S 状态机 | 防止 AI 跳过步骤 |
| 代码控制 | 架构合规引擎 | 防止非法调用和循环依赖 |
| 依赖控制 | 依赖治理工具 | 防止恶意依赖注入 |
| 审计控制 | Git Hash + SHA256 | 防止审计伪造 |
| 权限控制 | Tool-based 权限模型 | 防止 Agent 越权 |

## 三、威胁模型 (Threat Model)

| 威胁 | 描述 | 对策 | 风险等级 |
|-----|-----|-----|--------|
| AI 绕过流程 | AI 尝试直接进入 S5 阶段生成代码，跳过前期规划 | 强状态机 + MCP 工具拦截，非 S5 阶段拒绝代码生成 | 高 |
| Prompt 注入 | 恶意 Prompt 尝试修改状态机或绕过安全检查 | 不可变 Stage 设计，状态变更只能通过合法 API | 中 |
| 伪造审计 | 尝试修改或伪造审计记录 | Git Commit Hash 自动绑定 + SHA256 签名验证 | 高 |
| Agent 越权 | Agent 尝试调用超出其权限的工具 | Tool-based 权限控制，每个 Agent 只能访问授权工具 | 中 |
| 依赖风险 | 引入恶意或脆弱依赖 | 依赖白名单/黑名单机制，Pre-commit 自动检查 | 高 |
| 状态篡改 | 直接修改 state.json 绕过流程控制 | 状态变更日志 + 完整性验证 | 中 |

## 四、安全审计机制

### 4.1 审计记录内容

每条审计记录包含：
- **Stage**: 当前项目阶段 (S1-S5)
- **Commit Hash**: 关联的 Git 提交哈希
- **Actor/Agent**: 执行操作的主体
- **Action**: 执行的操作类型
- **Timestamp**: 操作时间
- **Approval Status**: 审批状态
- **SHA256**: 审计记录的哈希签名

### 4.2 审计完整性验证

提供 `verify_audit_integrity` 工具，用于：
- 验证审计记录的 SHA256 签名
- 检查 Git Commit Hash 的有效性
- 确保审计记录与代码变更一致

## 五、MCP Server 运行模式矩阵

| 运行模式 | 用途 | 安全特性 |
|---------|-----|---------|
| STDIO | Claude / Cursor / Trae 等本地 Agent | 轻量级，适合开发环境 |
| HTTP | Dashboard / Enterprise 部署 | 支持身份验证，适合生产环境 |

## 六、版本语义规范

### 6.1 版本号格式

采用语义化版本控制 (Semantic Versioning)：
- **MAJOR (x.0.0)**: 治理模型或 MCP 协议行为变化，不兼容旧版本
- **MINOR (1.x.0)**: 新增治理能力，不破坏现有行为
- **PATCH (1.0.x)**: Bug 修复 / 文档更新 / 非行为性调整

### 6.2 版本规划

| 阶段 | 版本 | 核心目标 |
|-----|-----|---------|
| Phase 1 | v1.1 | 工程一致性增强（强拦截） |
| Phase 2 | v1.5 | 高级治理工具集 |
| Phase 3 | v2.0 | 平台化 + 多 Agent 治理 |

## 七、发布与回滚策略

### 7.1 发布流程

1. **Git Tag**: 创建符合语义化版本的标签 (如 `v1.0.0`)
2. **GitHub Actions**: Tag 推送自动触发发布流程
3. **PyPI 发布**: 自动构建并发布到 PyPI
4. **MCP Registry 更新**: 同步更新 MCP 注册信息

### 7.2 回滚原则

- ❌ **不删除已发布版本**：PyPI 不允许删除已发布版本
- ✅ **只发布修复版本**：如发现问题，发布 `v1.0.1` 修复
- 📝 **公开记录问题**：在 GitHub Issues 中记录问题及修复方案

## 八、企业版预留能力

以下能力在 v1.0 中未实现，但已预留架构扩展点：

1. **多项目隔离**：支持多项目并行治理，数据隔离
2. **审计日志集中化**：支持将审计日志发送到集中化日志系统
3. **私有 MCP Registry**：支持部署私有 MCP 注册中心
4. **SSO / RBAC**：支持企业单点登录和基于角色的访问控制
5. **高级报告**：生成详细的项目治理报告和合规性分析

## 九、合规性考虑

### 9.1 开源合规

- 采用 MIT 许可证，允许商业使用
- 所有依赖均通过合规性检查
- 完整的开源贡献指南

### 9.2 企业合规

- 支持审计日志导出，满足 SOX、GDPR 等合规要求
- 可配置的访问控制，满足最小权限原则
- 完整的安全文档，支持企业安全评审

## 十、安全最佳实践

### 10.1 开发环境

- 启用 Pre-commit 钩子，自动执行安全检查
- 定期更新依赖，修复已知漏洞
- 遵循 5S 工作流，不跳过任何阶段

### 10.2 生产环境

- 使用 HTTP 模式部署，配置身份验证
- 定期备份审计日志
- 监控异常操作，设置告警机制

## 十一、安全响应流程

1. **报告**：通过 GitHub Issues 或安全邮箱报告安全问题
2. **评估**：安全团队评估问题严重性和影响范围
3. **修复**：开发团队优先修复高风险问题
4. **发布**：发布修复版本，更新安全公告
5. **回顾**：分析问题根源，更新威胁模型

## 十二、结论

AI Project OS MCP 采用了多层次的安全设计，通过强状态机、审计机制和权限控制，有效防止 AI 绕过工程流程，确保 AI 生成的代码符合真实软件工程标准。其核心设计理念"拒绝违规执行比勉强完成任务更正确"，为企业级 AI 开发提供了可靠的治理框架。

---

**版本**: 1.0.0
**发布日期**: 2025-12-20
**最后更新**: 2025-12-20